      SELECT d.device, d.in_max, d.in_avg, d.in_min, d.in_max_time, d.in_min_time, d.out_max, d.out_avg, d.out_min, d.out_max_time, d.out_min_time,
    v.power, v.vm_state, v.os_name, v.os_type, v.vcpu_num, v.memory, v.os_volume_type, v.os_volume_size, v.storage_num, v.volume_info,
    v.net_num, v.parenthostIp, v.parenthostname, COALESCE(d.uuid,v.uuid) as uuid, v.name, v.ip, v.az,
				COALESCE(v.cluster,d.cluster) as cluster, v.tenant, v.reportdate,COALESCE(v.cloud_uuid,d.cloud_uuid) as cloudUuid
    from
    (select * from oms_report_vm_iops_${zq} where reportdate &gt;= '${starReportDate}' AND reportdate &lt;= '${endReportDate}'
    AND cluster = '${cluster}' and cloud_uuid='${cloudUuid}'
    )d
    left join
    (select * from (
    select *,"row_number"() over(PARTITION by uuid order by "terminated" desc) as cnt from oms_vm_${zq}
    ) v1 where v1.cnt=1 and (v1.reportdate = '${endReportDate}'  OR (v1.terminated &gt;= '${starReportDate}' AND v1.terminated &lt;= '${endReportDate}'))
    AND v1.cluster = '${cluster}' and v1.cloud_uuid='${cloudUuid}'
    ) v
    on  d.uuid=v.uuid and d.cluster=v.cluster and d.cloud_uuid=v.cloud_uuid